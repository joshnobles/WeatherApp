<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Weather App</title>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    </head>
    <body>
        <div class="container">
            <div class="row mt-2">
                <div class="col">
                    <div class="form-floating">
                        <input type="text" class="form-control" id="zipCode" placeholder=" " maxlength="5">
                        <label for="zipCode">Enter Zip Code</label>
                    </div>
                </div>
                <div class="col">
                    <button id="submit" class="btn btn-success h-100" type="button" onclick="getWeather()">Get Forecast</button>
                </div> 
            </div>
            <div id="error" class="text-danger" hidden></div>
            <div id="result"></div>
        </div>
    </body>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>

    <script>

        document.querySelector('.container').addEventListener('keypress', (e) => {
            if (e.key == 'Enter')
                getWeather()
        })

        let error = document.querySelector('#error')
        let result = document.querySelector('#result')

        async function getWeather() {
            let input = document.querySelector('#zipCode').value

            error.hidden = true

            if (input.length != 5) {
                error.innerHTML = 'Must be a 5 digit zip code'
                error.hidden = false
                return
            }

            for (let c of input) {
                if (isNaN(parseInt(c))) {
                    error.innerHTML = 'All characters must be numbers'
                    error.hidden = false
                    return
                }
            }

            await fetch(`https://api.openweathermap.org/data/2.5/forecast?zip=${input},US&appid=8ebcafe50559caef12a8b9a1153a3caa`)
                .then(res => res.json())
                .then(json => {
                    if (json.cod != '200') {
                        if (json.cod == '404') {
                            error.innerHTML = 'City not found'
                            error.hidden = false
                            console.log(json)
                            return
                        }
                        error.innerHTML = 'There was an error getting the weather'
                        error.hidden = false
                        console.log(json)
                        return
                    }

                    result.innerHTML = '<hr>'
                    result.innerHTML += '<div class="row">'
                    result.innerHTML += `<div class="col-12 mb-4"><h3>Three day forecast for ${json.city.name}:</h3></div>`

                    let date = new Date(0)
                    let count = 0
                    for(let d of json.list) {
                        if (count == 3)
                            break

                        if (new Date(d.dt * 1000).getDate() == date.getDate())
                            continue

                        date = new Date(d.dt * 1000)
                        
                        result.innerHTML += '<ul class="list-group">'
                            
                        result.innerHTML += `<li class="list-group-item"><h5>${date.toLocaleDateString('en-us', { weekday:"long", year:"numeric", month:"short", day:"numeric"})}</h5></li>`
                        // result.innerHTML += `<li class="list-group-item"><div class="row"><div class="col-2"><strong>Date:</strong></div><div class="col-4">${date.toLocaleDateString('en-us', { weekday:"long", year:"numeric", month:"short", day:"numeric"})}</div></div></li>`
                        result.innerHTML += `<li class="list-group-item"><div class="row"><div class="col-2"><strong>Weather:</strong></div><div class="col-4">${d.weather[0].description}</div></div></li>`
                        result.innerHTML += `<li class="list-group-item"><div class="row"><div class="col-2"><strong>Temperature:</strong></div><div class="col-4">${Math.round(kToF(d.main.temp))}F</div></div></li>`
                        result.innerHTML += `<li class="list-group-item"><div class="row"><div class="col-2"><strong>Wind Speed:</strong></div><div class="col-4">${d.wind.speed} mph</div></div></li>`
                        result.innerHTML += '</ul>'
                        result.innerHTML += '<br>'
                        
                        count++
                    }

                    result.innerHTML += '</div>'
                })

        }

        function kToF(k) {
            return (k - 273.15) * 9/5 + 32
        }

    </script>

</html>